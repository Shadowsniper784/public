{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/public/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/runner/public/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/runner/public/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as React from\"react\";import{Switch,Route,useHistory}from\"react-router-dom\";import{Menu}from\"./components/Menu\";import{Sidebar}from\"./components/Sidebar\";import{DashboardPage}from\"./pages/Dashboard\";import{GuildContextProvider}from\"./utils/contexts/GuildContext\";import{GuildStoreContextProvider}from\"./utils/contexts/GuildStoreContext\";import{guilds as mockGuilds}from\"./__mocks__\";import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(),_React$useState2=_slicedToArray(_React$useState,2),guild=_React$useState2[0],setGuild=_React$useState2[1];var _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),guilds=_React$useState4[0],setGuilds=_React$useState4[1];var _React$useState5=React.useState(),_React$useState6=_slicedToArray(_React$useState5,2),token=_React$useState6[0],setToken=_React$useState6[1];var history=useHistory();//const { loading, error } = useQuery(getUser, {\n// onCompleted: ({ getUser }) => {\n//   const { guilds } = getUser;\n//     setGuilds(guilds);\n//   },\n// });\n// console.log(error);\n// if (loading) return <h1>Loading</h1>;\n// if (error) return <h1>You are making too many requests.</h1>;\nReact.useEffect(function(){function run(){return _run.apply(this,arguments);}function _run(){_run=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var inst,search,query,data,_data,servers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:inst=axios.create({baseURL:'https://public.shadowsniper784.repl.co'});search=window.location.search;query=new URLSearchParams(search);if(!(query.has('code')||window.localStorage.getItem('access_token')&&window.localStorage.getItem('refresh_on')&&Math.round(Date.now()/1000)<parseInt(window.localStorage.getItem('refresh_on'))||window.localStorage.getItem('refresh_token'))){_context.next=38;break;}if(!query.has('code')){_context.next=17;break;}console.log('Has code: %s',query.get('code'));_context.next=8;return axios.get('/api/access',{params:{code:query.get('code')}});case 8:data=_context.sent;console.log('Request finished: %o',data);data=data.data;window.localStorage.setItem('access_token',data.access_token);window.localStorage.setItem('refresh_on',data.refresh_on);window.localStorage.setItem('refresh_token',data.refresh_token);setToken(data.access_token);_context.next=30;break;case 17:if(!(window.localStorage.getItem('access_token')&&window.localStorage.getItem('refresh_on')&&Date.now()<parseInt(window.localStorage.getItem('refresh_on')))){_context.next=22;break;}console.log('No request needed access token: %s',window.localStorage.getItem('access_token'));setToken(window.localStorage.getItem('access_token'));_context.next=30;break;case 22:_context.next=24;return axios.post('/api/refresh',{refresh_token:window.localStorage.getItem('refresh_token')});case 24:_data=_context.sent;console.log('Request now %o',_data);_data=_data.data;window.localStorage.setItem('access_token',_data.access_token);window.localStorage.setItem('refresh_on',_data.refresh_on);setToken(_data.access_token);case 30:console.log('Getting guilds: %s',window.localStorage.getItem('access_token'));_context.next=33;return axios.post('/api/guilds',{access_token:window.localStorage.getItem('access_token')});case 33:servers=_context.sent;console.log('Request finished: %o',servers);setGuilds(servers.data);_context.next=40;break;case 38:console.log(\"Setting Guilds\");setGuilds(mockGuilds);case 40:case\"end\":return _context.stop();}}},_callee);}));return _run.apply(this,arguments);}run();},[]);return/*#__PURE__*/_jsxs(Providers,{guild:guild,setGuild:setGuild,guilds:guilds,setGuilds:setGuilds,children:[/*#__PURE__*/_jsx(Sidebar,{guilds:guilds,history:history}),/*#__PURE__*/_jsx(Menu,{title:guild?guild.name:'Shadow Public',history:history}),/*#__PURE__*/_jsx(Routes,{})]});}function Providers(_ref){var children=_ref.children,guild=_ref.guild,setGuild=_ref.setGuild,guilds=_ref.guilds,setGuilds=_ref.setGuilds;setGuilds(guilds.filter(function(e){return e.permissions==8;}));return/*#__PURE__*/_jsx(GuildContextProvider,{value:{guild:guild,setGuild:setGuild},children:/*#__PURE__*/_jsx(GuildStoreContextProvider,{value:{guilds:guilds,setGuilds:setGuilds},children:children})});}function Routes(){return/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",exact:true,component:DashboardPage}),/*#__PURE__*/_jsx(Route,{path:\"/dashboard/:guildId\",exact:true,component:DashboardPage}),/*#__PURE__*/_jsx(Route,{path:\"/dashboard/:guildId/general/muted\",exact:true,component:DashboardPage})]});}export default App;","map":{"version":3,"sources":["/home/runner/public/dashboard/src/App.tsx"],"names":["React","Switch","Route","useHistory","Menu","Sidebar","DashboardPage","GuildContextProvider","GuildStoreContextProvider","guilds","mockGuilds","axios","App","useState","guild","setGuild","setGuilds","token","setToken","history","useEffect","run","inst","create","baseURL","search","window","location","query","URLSearchParams","has","localStorage","getItem","Math","round","Date","now","parseInt","console","log","get","params","code","data","setItem","access_token","refresh_on","refresh_token","post","servers","name","Providers","children","filter","e","permissions","Routes"],"mappings":"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","sourcesContent":["\nimport * as React from \"react\";\nimport { Switch, Route, Redirect, useHistory } from \"react-router-dom\";\nimport { Menu } from \"./components/Menu\";\nimport { Sidebar } from \"./components/Sidebar\";\nimport { DashboardPage } from \"./pages/Dashboard\";\nimport { GuildContextProvider } from \"./utils/contexts/GuildContext\";\nimport { GuildStoreContextProvider } from \"./utils/contexts/GuildStoreContext\";\nimport { Guild } from \"./utils/types\";\nimport { useQuery } from \"@apollo/client\";\nimport { getUser } from \"./graphql\";\nimport { guilds as mockGuilds } from \"./__mocks__\";\nimport axios from 'axios'\n\nfunction App() {\n  const [guild, setGuild] = React.useState<Guild | undefined>();\n  const [guilds, setGuilds] = React.useState<Guild[]>([]);\n  const [token, setToken] = React.useState<any>()\n  const history = useHistory();\n\n   //const { loading, error } = useQuery(getUser, {\n   // onCompleted: ({ getUser }) => {\n   //   const { guilds } = getUser;\n  //     setGuilds(guilds);\n  //   },\n  // });\n\n  // console.log(error);\n\n  // if (loading) return <h1>Loading</h1>;\n  // if (error) return <h1>You are making too many requests.</h1>;\n  React.useEffect(() => {\n  \n    async function run() {\n      const inst = axios.create({\n  baseURL: 'https://public.shadowsniper784.repl.co'\n})\n    let search = window.location.search;\nlet query = new URLSearchParams(search)\n    if(query.has('code') || \n       (\n         window.localStorage.getItem('access_token') && \n         window.localStorage.getItem('refresh_on') &&\n         Math.round(Date.now() / 1000) < parseInt(window.localStorage.getItem('refresh_on')!)\n       ) || \n       window.localStorage.getItem('refresh_token')) {\n      if(query.has('code')) {\n        console.log('Has code: %s',query.get('code'))\n        let data: any = await axios.get('/api/access',{\n          params:{\n           code: query.get('code')\n        }\n      })\n        console.log('Request finished: %o', data)\n        data = data.data\n  \n        window.localStorage.setItem('access_token',data.access_token)\n        window.localStorage.setItem('refresh_on',data.refresh_on)\n        window.localStorage.setItem('refresh_token',data.refresh_token)\n        setToken(data.access_token)\n      } else if(window.localStorage.getItem('access_token') && window.localStorage.getItem('refresh_on') && Date.now() < parseInt(window.localStorage.getItem('refresh_on')!)) {\n        console.log('No request needed access token: %s',window.localStorage.getItem('access_token'))\n        setToken(window.localStorage.getItem('access_token')!)\n      } else {\n        let data:any = await axios.post('/api/refresh',{\n          refresh_token:window.localStorage.getItem('refresh_token')\n        })\n        console.log('Request now %o',data)\n        data=data.data\n\n         window.localStorage.setItem('access_token',data.access_token)\n        window.localStorage.setItem('refresh_on',data.refresh_on)\n        setToken(data.access_token)\n      }\n              console.log('Getting guilds: %s', window.localStorage.getItem('access_token'))\n      let servers: any = await axios.post('/api/guilds',{access_token:window.localStorage.getItem('access_token') })\n              console.log('Request finished: %o', servers)\n      setGuilds(servers.data)\n    } else {\n       \n    console.log(\"Setting Guilds\");\n    setGuilds(mockGuilds);\n    }\n    }\n    run()\n  }, []);\n\n  return (\n    <Providers\n      guild={guild}\n      setGuild={setGuild}\n      guilds={guilds}\n      setGuilds={setGuilds}\n    >\n      <Sidebar guilds={guilds} history={history} />\n      <Menu title={guild ? guild.name : 'Shadow Public'} history={history} />\n      <Routes />\n    </Providers>\n  );\n}\n\nfunction Providers({ children, guild, setGuild, guilds, setGuilds }: any) {\n  setGuilds(guilds.filter(e=>e.permissions == 8))\n  return (\n    <GuildContextProvider value={{ guild, setGuild }}>\n      <GuildStoreContextProvider value={{ guilds, setGuilds }}>\n        {children}\n      </GuildStoreContextProvider>\n    </GuildContextProvider>\n  );\n}\n\nfunction Routes() {\n  return (\n    <Switch>\n      <Route path=\"/\" exact={true} component={DashboardPage} />\n      <Route\n        path=\"/dashboard/:guildId\"\n        exact={true}\n        component={DashboardPage}\n      />\n      <Route\n        path=\"/dashboard/:guildId/general/muted\"\n        exact={true}\n        component={DashboardPage}\n      />\n    </Switch>\n  );\n}\n\nexport default App;\n\n"]},"metadata":{},"sourceType":"module"}